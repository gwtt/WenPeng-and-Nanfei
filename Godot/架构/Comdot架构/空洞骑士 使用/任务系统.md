 (Observer/Event Bus 模式)

任务系统通常由三部分组成：任务数据(Resource)、任务管理器(Autoload)、触发器。

架构概览：

> Quest Resource (任务定义)
> - id: String (唯一标识)
> - title: String
> - description: String
> - target_count: int (例如：杀10只怪)
> - current_count: int

> Quest Manager (全局单例)
> - 管理已接受的任务列表。
> - 监听全局信号。


```GDscript

# quest_manager.gd (Autoload: QuestSystem)

extends Node

signal quest_completed(quest_id)
signal quest_updated(quest_id, current, target)
var active_quests: Array[QuestResource] = []
# 监听杀怪事件

func _ready():
    # 假设你有一个全局事件总线 EventBus
    EventBus.enemy_died.connect(_on_enemy_died)

func _on_enemy_died(enemy_type: String):
    for quest in active_quests:
        if quest.target_enemy_type == enemy_type and not quest.is_completed:
            quest.current_count += 1
            emit_signal("quest_updated", quest.id, quest.current_count, quest.target_count)
            if quest.current_count >= quest.target_count:
                complete_quest(quest)
                
func accept_quest(quest_res: QuestResource):
    var new_quest = quest_res.duplicate() # 必须复制，因为Resource是共享的
    active_quests.append(new_quest)
```
