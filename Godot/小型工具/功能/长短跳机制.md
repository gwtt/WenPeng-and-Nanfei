```GDScript
extends BaseCapability
class_name PlayerJumpCapability

var body : CharacterBody2D

func on_active():
	body = owner as CharacterBody2D

func tick_active(delta):
	var velocity = body.velocity
	if Input.is_action_just_pressed("jump"):
		if !body.is_on_floor(): return
		velocity.y = -component.jump_speed
	if velocity.y < 0 and !Input.is_action_pressed("jump"):
		# 长按跳：不追加额外上升期重力；松开则追加额外重力以实现短跳
		velocity.y += component.jump_higher * delta * component.gravity
	velocity.y += component.gravity * delta
	body.velocity.y = velocity.y
```

原理很简单：通过“上升期的额外重力”来控制跳跃高度，实现可变长短跳。
- 关键判断：`if velocity.y < 0` 表示正在上升（Godot 2D 中 y 向下为正，所以向上为负）。
- 长按：当仍然按住跳跃键时，只施加正常重力 `component.gravity`，上升减速较慢，上升更高。
- 松开：一旦松开跳跃键，在上升期额外叠加一份重力 `component.jump_higher * delta * component.gravity`，相当于“加大上升期重力”，让竖直速度更快由负转正，上升更快结束，跳得更矮。
- 总效果：按住时间越长，上升阶段受到的“额外重力”越少，上升越久；反之越早松开，额外重力越早介入，上升越短。


> 下面是错误案例
```GDScript
extends BaseCapability
class_name PlayerJumpCapability

var body : CharacterBody2D

func on_active():
	body = owner as CharacterBody2D

func tick_active(delta):
	var velocity = body.velocity
	if Input.is_action_just_pressed("jump"):
		if !body.is_on_floor(): return
		velocity.y = -component.jump_speed
	else:
		if velocity.y < 0:
			# 长按跳：不追加额外上升期重力；松开则追加额外重力以实现短跳
			velocity.y += component.jump_higher * delta * component.gravity
	velocity.y += component.gravity * delta
	body.velocity.y = velocity.y

```

不行的原因在于把“短跳额外重力”的判断绑在了 just_pressed 的 else 分支上，语义被改变了：

- `is_action_just_pressed("jump")` 只在按下的那一帧为真；后续所有帧都会走 `else`。这样会导致即使玩家还在按住跳键，依然会进入 `else`，从而给上升期叠加“额外重力”，把“长按也变成短跳”。
- 正确逻辑应该与“是否仍在按住跳键”绑定，而不是与“是否是刚刚按下”绑定。也就是：当且仅当“仍在上升且没有按住跳键”时，才叠加额外重力。

建议改回两段独立判断，而不是 `else`：

```gdscript
if Input.is_action_just_pressed("jump"):
	if !body.is_on_floor(): return
	velocity.y = -component.jump_speed

if velocity.y < 0 and !Input.is_action_pressed("jump"):
	velocity.y += component.jump_higher * delta * component.gravity
```

- 上面第一段只负责首帧起跳；  
- 第二段每帧检查：正在上升且松开跳时，才加额外重力，实现短跳；长按时不加额外重力，实现长跳。

`Input.is_action_pressed("jump")` 只表示当前帧是否正在按住跳跃键，与按了多久无关。

- 按住期间：返回 `true`
- 松开后：返回 `false`

长短跳的区别在于松开的时间点，而不是 `is_action_pressed` 的返回值。

- 长按：松开得晚（可能在上升后期或已在下落时）
- 短按：松开得早（在上升阶段就松开）

因此，在上升阶段（`velocity.y < 0`）：
- 如果 `!Input.is_action_pressed("jump")` 为 `true`（已松开），就加上额外重力，实现短跳
- 如果 `Input.is_action_pressed("jump")` 为 `true`（还在按住），就不加额外重力，实现长跳

所以代码逻辑是：在上升阶段，如果检测到已经松开，就加上额外重力来缩短跳跃高度。
> 
当用户在当前帧或物理周期中开始按下动作事件时返回 true。只在用户按下按钮的那一帧或周期中为 true。
